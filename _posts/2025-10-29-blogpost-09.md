---
title: "MalBuster: Analysing Malware"
excerpt: An analysis of four different pieces of malware, using standard tools like pe-tree, pestudio and capa 
date: 2025-10-29
---


## 1 Introduction

The room *MalBuster* in the *Malware Analysis* module on TryHackMe.com constitutes the first "challenge" in the sense that we are asked to use the tools and tricks we learned in the preceding rooms to analyse a given set of malicious files that are stored in the attached VM. The task is to answer questions about these files, an thus prove that I am sufficiently proficient with tools like pe-tree, pestudio and capa.


## 2 Challenge

After starting the REMnux VM, the first thing I did was run the command 
```console
ubuntu@ip-10-10-80-81:~/Desktop/Samples$ pe-tree malbuster_1
```
in the terminal. After a couple of seconds pe-tree launched successfully. Looking at "Architecture" and "Characteristics" in FILE_HEADER gives the answer to the first two questions:

<div class="flex justify-center items-center">
  <img
    src="https://github.com/user-attachments/assets/51c1f8ca-fecc-42ec-bbcd-3c2cd3af79ca"
    alt="image"
    class="clickable-img h-auto w-auto max-w-full max-h-[232px] object-contain"
  />
</div>
<br>

> Q1: Based on the ARCHITECTURE of the binary, is malbuster_1 a 32-bit or a 64-bit application? (32-bit/64-bit)
> 
> A1: 32-bit

> Q2: What is the MD5 hash of malbuster_1?
>
> A2: 4348da65e4aeae6472c7f97d6dd8ad8f

For the next question, we navigate to virustotal.com in the browser and simply read off the answer:

> Q3: Using the hash, what is the popular threat label of malbuster_1 according to VirusTotal?
>
> A3: trojan.zbot/razy

Next, we run `pe-tree` on the second malware `malbuster_2`. We paste its MD5 hash into virustotal.com to view further information about its severity and impact according to third-parties.

<div class="flex justify-center items-center">
  <img
    src="https://github.com/user-attachments/assets/74e1e9ca-76e1-426c-b065-4f5ff8b4fa45"
    alt="image"
    class="clickable-img h-auto w-auto max-w-full max-h-[232px] object-contain"
  />
</div>
<br>

> Q4: Based on VirusTotal detection, what is the malware signature of malbuster_2 according to Avira?
>
> A4: HEUR/AGEN.1306860

Continuing with the pe-tree output for malbuster_2, we click through to IMAGE_IMPORT_DESCRIPTOR to answer the fifth question:

<div class="flex justify-center items-center">
  <img
    src="https://github.com/user-attachments/assets/9f2dcb90-e607-41a1-b006-f20fe423ccf8"
    alt="image"
    class="clickable-img h-auto w-auto max-w-full max-h-[232px] object-contain"
  />
</div>
<br>

> Q5: malbuster_2 imports the function _CorExeMain. From which DLL file does it import this function?
>
> A5: mscoree.dll

If we navigate to VS_VERSIONINFO, we find the "OriginalFileName":

> Q6: Based on the VS_VERSION_INFO header, what is the original name of malbuster_2?
>
> A6: 7JYpE.exe

Next, we move to malbuster_3. For the first question about this piece of malware, we need to sign up to [abuse.ch](https://abuse.ch). After finding the MD5 hash of malbuster_3 through pe-tree, we can paste it into the Hunting tab of abuse.ch.

<div class="flex justify-center items-center">
  <img
    src="https://github.com/user-attachments/assets/3bb54007-8fbf-48db-985c-2a173e14722a"
    alt="image"
    class="clickable-img h-auto w-auto max-w-full max-h-[232px] object-contain"
  />
</div>
<br>

> Q7: Using the hash of malbuster_3, what is its malware signature based on abuse.ch?
>
> A7: TrickBot

We repeat the same steps for malbuster_4:

> Q8: Using the hash of malbuster_4, what is its malware signature based on abuse.ch?
>
> A8: ZLoader

Navigating to the DOS_STUB of malbuster_4 answers the next question:

<div class="flex justify-center items-center">
  <img
    src="https://github.com/user-attachments/assets/20e53a65-09f9-4ca4-9b07-4f5d286d2498"
    alt="image"
    class="clickable-img h-auto w-auto max-w-full max-h-[232px] object-contain"
  />
</div>
<br>

> Q9: What is the message found in the DOS_STUB of malbuster_4?
>
> A9: !This Salfram cannot be run in DOS mode.

The next question asks from which DLL file the function `ShellExecuteA` is imported in malbuster_4. To this end, we first go to IMAGE_IMPORT_DESCRIPTOR again, and then we look for the function. The problem is that there is an abundance of DLL files, so we need to make an educated guess as to which DLL file might be the correct one. Looking through the list, we find `shell32.dll`, which looks promising, since the function had something to do with shells. Indeed, we find `ShellExecuteA` if we click on `shell32.dll`.

> Q10: malbuster_4 imports the function ShellExecuteA. From which DLL file does it import this function?
>
> A10: shell32.dll

The next few questions ask us to work with capa. First, we look at malbuster_1 once more. Here is the entire output of running capa:
```console
ubuntu@ip-10-10-146-149:~/Desktop/Samples$ capa malbuster_1
loading : 100%|████████████████████████████████████████████████████████████████████████████████████████| 703/703 [00:00<00:00, 1199.19 rules/s]
matching: 100%|████████████████████████████████████████████████████| 412/412 [00:21<00:00, 19.06 functions/s, skipped 4 library functions (0%)]
+------------------------+------------------------------------------------------------------------------------+
| md5                    | 4348da65e4aeae6472c7f97d6dd8ad8f                                                   |
| sha1                   | 8bf60eea83c34ec9de2359219978b8805f2629e3                                           |
| sha256                 | 000415d1c7a7a838ba2ef00874e352e8b43a57e2f98539b5908803056f883176                   |
| os                     | windows                                                                            |
| format                 | pe                                                                                 |
| arch                   | i386                                                                               |
| path                   | malbuster_1                                                                        |
+------------------------+------------------------------------------------------------------------------------+

+------------------------+------------------------------------------------------------------------------------+
| ATT&CK Tactic          | ATT&CK Technique                                                                   |
|------------------------+------------------------------------------------------------------------------------|
| DEFENSE EVASION        | Obfuscated Files or Information T1027                                              |
|                        | Virtualization/Sandbox Evasion::System Checks T1497.001                            |
+------------------------+------------------------------------------------------------------------------------+

+-----------------------------+-------------------------------------------------------------------------------+
| MBC Objective               | MBC Behavior                                                                  |
|-----------------------------+-------------------------------------------------------------------------------|
| ANTI-BEHAVIORAL ANALYSIS    | Virtual Machine Detection [B0009]                                             |
| COMMUNICATION               | HTTP Communication::Read Header [C0002.014]                                   |
| CRYPTOGRAPHY                | Encrypt Data::RC4 [C0027.009]                                                 |
|                             | Generate Pseudo-random Sequence [C0021]                                       |
|                             | Generate Pseudo-random Sequence::Mersenne Twister [C0021.005]                 |
|                             | Generate Pseudo-random Sequence::RC4 PRGA [C0021.004]                         |
| DATA                        | Checksum::CRC32 [C0032.001]                                                   |
|                             | Encode Data::XOR [C0026.002]                                                  |
| DEFENSE EVASION             | Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]      |
| DISCOVERY                   | Code Discovery::Enumerate PE Sections [B0046.001]                             |
+-----------------------------+-------------------------------------------------------------------------------+

+------------------------------------------------------+------------------------------------------------------+
| CAPABILITY                                           | NAMESPACE                                            |
|------------------------------------------------------+------------------------------------------------------|
| reference anti-VM strings                            | anti-analysis/anti-vm/vm-detection                   |
| check HTTP status code (2 matches)                   | communication/http/client                            |
| hash data with CRC32                                 | data-manipulation/checksum/crc32                     |
| encode data using XOR (10 matches)                   | data-manipulation/encoding/xor                       |
| encrypt data using RC4 PRGA (3 matches)              | data-manipulation/encryption/rc4                     |
| generate random numbers using the Delphi LCG         | data-manipulation/prng/lcg                           |
| generate random numbers using a Mersenne Twister     | data-manipulation/prng/mersenne                      |
| enumerate PE sections (2 matches)                    | load-code/pe                                         |
| resolve function by parsing PE exports               | load-code/pe                                         |
+------------------------------------------------------+------------------------------------------------------+
```

We can simply read off the number of times any anti-VM measures are mentioned.

> Q11: Using capa, how many anti-VM instructions were identified in malbuster_1?
>
> A11: 3

Next, we need to run capa on all binaries in order to find the correct answer. We're looking for the binary that seems to be logging keystrokes. In malbuster_3, we find the following:
```console
ubuntu@ip-10-10-146-149:~/Desktop/Samples$ capa malbuster_3
.
.
.
+-----------------------------+-------------------------------------------------------------------------------+
| MBC Objective               | MBC Behavior                                                                  |
|-----------------------------+-------------------------------------------------------------------------------|
| COLLECTION                  | Keylogging::Application Hook [F0002.001]                                      |
|                             | Keylogging::Polling [F0002.002]                                               |
.
.
.
```

Thus, we have:

> Q12: Using capa, which binary can log keystrokes?
>
> A12: malbuster_3

Running capa on malbuster_4, we also quickly find the answer to the next question.

> Q13: Using capa, what is the MITRE ID of the DISCOVERY technique used by malbuster_4?
>
> A13: T1083

The final two questions call for the `strings` binary. First, we are asked to find the binary which contains the string "GodMode":
```console
ubuntu@ip-10-10-146-149:~/Desktop/Samples$ strings malbuster_2 | grep GodMode
get_GodMode
set_GodMode
GodMode
```

> Q14: Which binary contains the string GodMode?
>
> A14: malbuster_2

Lastly, we need to look for the string "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)", so we just run through all four binaries to find the correct one:
```console
ubuntu@ip-10-10-146-149:~/Desktop/Samples$ strings malbuster_1 | grep "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)"
Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)
```

> Q15: Which binary contains the string Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)?
>
> A15: malbuster_1

All in all, I feel like these exercises were fairly easy. Nonetheless, it was interesting to analyse these malicious binaries, not knowing about their original intent and only learning about their properties through careful analysis.









